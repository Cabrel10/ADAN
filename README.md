# üöÄ ADAN - Agent de D√©cision Algorithmique Neuronal

[![Python 3.11](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

ADAN est une plateforme avanc√©e de trading algorithmique bas√©e sur l'apprentissage par renforcement (RL). Le syst√®me utilise un agent PPO avec extracteur CNN pour apprendre des strat√©gies de trading rentables sur des donn√©es multi-assets avec indicateurs techniques sp√©cifiques par timeframe.

## üìã Table des mati√®res
- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [Utilisation](#-utilisation)
- [Structure du Projet](#-structure-du-projet)
- [Contribution](#-contribution)
- [Licence](#-licence)

## ‚ú® Fonctionnalit√©s

### üìä Syst√®me Multi-Assets et Multi-Lots
- **Lot 1 (DOGE & Co)** : 5 cryptomonnaies (ADAUSDT, DOGEUSDT, LTCUSDT, SOLUSDT, XRPUSDT) - Timeframe 1h, ~18 features
- **Lot 2 (BTC & Co)** : 5 cryptomonnaies (ADAUSDT, BNBUSDT, BTCUSDT, ETHUSDT, XRPUSDT) - Timeframe 1m, 47 features avanc√©es
- Gestion intelligente du portefeuille avec allocation dynamique
- Syst√®me de paliers adaptatif selon le capital disponible

### üìà Indicateurs Techniques Multi-Niveaux
- **Lot 1 (Indicateurs Standard)** : OHLCV, RSI, EMA, MACD, Bollinger Bands, ATR (~18 features)
- **Lot 2 (Indicateurs Avanc√©s)** : OHLCV + SMA, EMA, RSI, MACD, Bollinger, ATR, Stochastic, ADX, CCI, Momentum, ROC, Williams %R, TRIX, Ultimate Oscillator, DPO, OBV, VWMA, CMF, MFI, Parabolic SAR, Ichimoku, KAMA, VWAP, Stoch RSI, CMO, PPO, Fisher Transform, HMM Regime Detection (47 features)
- **Timeframes Flexibles** : 1m (scalping), 1h (day trading), 1d (swing trading)

### üß† Architecture IA Sophistiqu√©e
- Agent PPO avec MultiInputPolicy
- CNN Feature Extractor pour l'analyse temporelle
- Support CPU et GPU avec configurations optimis√©es
- **Entra√Ænement parall√®le** : VecEnv avec n_envs configurable (1-8 environnements)
- **Traitement par chunks** pour gros volumes de donn√©es (√©vite les erreurs de m√©moire)
- **Dynamic Behavior Engine (DBE)** : Gestion dynamique des param√®tres de trading
- **Apprentissage continu** avec mise √† jour en temps r√©el des strat√©gies

### üîÑ Pipeline de Donn√©es Robuste
- Collecte automatis√©e via CCXT (Binance)
- Traitement et normalisation des indicateurs
- Fusion multi-assets avec validation compl√®te
- Support de plusieurs timeframes simultan√©s

### üéì Apprentissage en Ligne Avanc√©
- **M√©moire de Rejeu Prioritaire** : √âchantillonnage intelligent des exp√©riences les plus instructives
- **Elastic Weight Consolidation (EWC)** : Pr√©vention de l'oubli catastrophique lors de l'apprentissage continu
- **Mise √† jour du r√©seau cible** : Pour une stabilit√© accrue de l'apprentissage
- **Optimisation CPU/GPU** : Support natif pour les environnements CPU et GPU
- **Journalisation compl√®te** : Suivi d√©taill√© des m√©triques d'apprentissage via TensorBoard

## üöÄ Nouvelles Fonctionnalit√©s (Sprint 4)

### üéì Apprentissage en Ligne Avanc√©
L'agent d'apprentissage en ligne permet d'am√©liorer continuellement le mod√®le en temps r√©el avec de nouvelles donn√©es de march√©.

**Fonctionnalit√©s cl√©s** :
- **M√©moire de Rejeu Prioritaire** : Am√©liore l'efficacit√© de l'apprentissage en se concentrant sur les exp√©riences les plus instructives
- **Elastic Weight Consolidation (EWC)** : Emp√™che l'oubli des connaissances pr√©c√©dentes lors de l'apprentissage de nouvelles strat√©gies
- **Mise √† jour asynchrone** : Mise √† jour du mod√®le en arri√®re-plan sans interrompre le trading
- **Sauvegarde automatique** : Sauvegarde p√©riodique du mod√®le et du buffer d'exp√©rience

**Utilisation** :
```bash
python scripts/run_online_learning.py \
  --model-path models/rl_agents/adan_ppo_latest.zip \
  --config config/online_learning_config.yaml \
  --env-config config/environment_config.yaml \
  --save-path models/online \
  --tensorboard-log logs/online \
  --steps 100000
```

**Configuration recommand√©e** :
- `experience_buffer_size`: 100000 (taille du buffer d'exp√©rience)
- `batch_size`: 128 (taille des lots d'apprentissage)
- `learning_rate`: 1e-5 (taux d'apprentissage)
- `use_prioritized_replay`: true (activer la m√©moire de rejeu prioritaire)
- `use_ewc`: true (activer EWC pour √©viter l'oubli catastrophique)
- `target_update_freq`: 1000 (fr√©quence de mise √† jour du r√©seau cible)

## üöÄ Nouvelles Fonctionnalit√©s (Sprint 3)

### üîÑ Dynamic Behavior Engine (DBE)
Le DBE est un syst√®me expert qui adapte dynamiquement les strat√©gies de trading en fonction des conditions du march√© et des performances du portefeuille.

**Fonctionnalit√©s cl√©s** :
- Ajustement automatique des stops-loss et take-profit
- Gestion dynamique de la taille des positions
- D√©tection des r√©gimes de march√© (tendance, range, volatilit√©)
- Adaptation en temps r√©el des strat√©gies

### üìö Apprentissage Continu
- Mise √† jour du mod√®le en temps r√©el avec les nouvelles donn√©es de march√©
- R√©entra√Ænement p√©riodique pour s'adapter aux changements de march√©
- Sauvegarde et restauration de l'√©tat de l'agent

## üéØ Utilisation du DBE

### Configuration
Le DBE est configur√© via le fichier `config/environment_config.yaml` dans la section `dynamic_behavior` :

```yaml
dynamic_behavior:
  # Param√®tres de gestion du risque
  risk_management:
    initial_sl_pct: 0.02  # Stop-loss initial (2%)
    initial_tp_pct: 0.04  # Take-profit initial (4%)
    max_position_size: 0.1  # Taille maximale de position (10% du capital)
    
  # D√©tection des r√©gimes de march√©
  market_regime_detection:
    volatility_lookback: 20  # P√©riode de lookback pour le calcul de la volatilit√©
    trend_lookback: 50      # P√©riode de lookback pour la d√©tection de tendance
    
  # Param√®tres d'adaptation
  adaptation:
    learning_rate: 0.01     # Vitesse d'adaptation des param√®tres
    min_volatility: 0.005   # Volatilit√© minimale pour √©viter les divisions par z√©ro
    max_volatility: 0.10    # Volatilit√© maximale pour le calcul des param√®tres
```

### Utilisation dans le code

```python
from src.adan_trading_bot.environment import MultiAssetEnv
from src.adan_trading_bot.environment.dbe import DynamicBehaviorEngine

# Cr√©er l'environnement avec le DBE activ√©
env = MultiAssetEnv(config=config, use_dbe=True)

# Acc√©der au DBE
dbe = env.dbe

# Mettre √† jour les m√©triques
dbe.update_metrics(
    portfolio_metrics={
        'equity': portfolio_value,
        'drawdown': current_drawdown,
        'sharpe': sharpe_ratio
    },
    market_data={
        'prices': current_prices,
        'volumes': current_volumes,
        'volatility': current_volatility
    }
)

# Obtenir les param√®tres de trading actuels
params = dbe.get_trading_parameters()
print(f"Stop-Loss: {params['sl_pct']:.2%}")
print(f"Take-Profit: {params['tp_pct']:.2%}")
print(f"Taille de position: {params['position_size']:.2f}")
```

### Visualisation des m√©triques
Le DBE enregistre des m√©triques d√©taill√©es qui peuvent √™tre visualis√©es avec TensorBoard :

```bash
tensorboard --logdir=./reports/dbe_metrics
```

### Tests unitaires
Pour ex√©cuter les tests du DBE :

```bash
pytest tests/environment/test_dbe.py -v
```

## üõ† Installation

### Pr√©requis
- Python 3.11
- CUDA 11.8+ (pour GPU)
- 8GB+ RAM (CPU) / 32GB+ RAM (GPU)
- [Miniconda](https://docs.conda.io/en/latest/miniconda.html) (recommand√©)
- [Git](https://git-scm.com/)

### M√©thode 1 : Installation avec Conda (Recommand√©)

```bash
# 1. Cloner le d√©p√¥t
git clone https://github.com/votre-utilisateur/adan-trading-bot.git
cd adan-trading-bot

# 2. Cr√©er et activer l'environnement conda
conda create -n adan python=3.11 -y
conda activate adan

# 3. Installer les d√©pendances de base
pip install -r requirements.txt

# 4. Pour l'acc√©l√©ration GPU (optionnel)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# 5. Installer pre-commit (recommand√©)
pip install pre-commit
pre-commit install
```

### M√©thode 2 : Installation avec venv

```bash
# 1. Cloner le d√©p√¥t
git clone https://github.com/votre-utilisateur/adan-trading-bot.git
cd adan-trading-bot

# 2. Cr√©er et activer l'environnement virtuel
python -m venv venv
source venv/bin/activate  # Sur Windows: .\venv\Scripts\activate

# 3. Mettre √† jour pip et installer les d√©pendances
pip install --upgrade pip
pip install -r requirements.txt

# 4. Installer pre-commit (recommand√©)
pip install pre-commit
pre-commit install
```

## ‚öôÔ∏è Configuration

### Configuration de l'environnement

1. Copiez le fichier `.env.example` vers `.env` :
   ```bash
   cp .env.example .env
   ```

2. Modifiez le fichier `.env` avec vos param√®tres :
   ```ini
   # Configuration de l'API Binance (obligatoire pour le mode live)
   BINANCE_API_KEY=votre_cle_api_ici
   BINANCE_API_SECRET=votre_secret_api_ici
   
   # Param√®tres g√©n√©raux
   LOG_LEVEL=INFO
   ENVIRONMENT=dev
   
   # Param√®tres de trading
   INITIAL_CAPITAL=10000
   MAX_POSITION_SIZE=0.1
   MAX_DAILY_TRADES=10
   ```

### Structure des r√©pertoires

```
ADAN/
‚îú‚îÄ‚îÄ config/               # Fichiers de configuration
‚îú‚îÄ‚îÄ data/                 # Donn√©es brutes et trait√©es
‚îÇ   ‚îú‚îÄ‚îÄ raw/             # Donn√©es brutes
‚îÇ   ‚îú‚îÄ‚îÄ processed/       # Donn√©es trait√©es
‚îÇ   ‚îî‚îÄ‚îÄ models/          # Mod√®les entra√Æn√©s
‚îú‚îÄ‚îÄ docs/                # Documentation
‚îú‚îÄ‚îÄ notebooks/           # Notebooks d'analyse
‚îú‚îÄ‚îÄ scripts/             # Scripts utilitaires
‚îú‚îÄ‚îÄ src/                 # Code source
‚îÇ   ‚îî‚îÄ‚îÄ adan_trading_bot/
‚îÇ       ‚îú‚îÄ‚îÄ agent/       # D√©finition de l'agent RL
‚îÇ       ‚îú‚îÄ‚îÄ common/      # Utilitaires communs
‚îÇ       ‚îú‚îÄ‚îÄ data_processing/  # Traitement des donn√©es
‚îÇ       ‚îú‚îÄ‚îÄ environment/ # Environnement de trading
‚îÇ       ‚îî‚îÄ‚îÄ training/    # Scripts d'entra√Ænement
‚îî‚îÄ‚îÄ tests/               # Tests unitaires et d'int√©gration
```

## üöÄ Utilisation

### Pr√©paration des donn√©es

```bash
# Traitement des donn√©es brutes
python scripts/process_data.py --config config/data_config.yaml

# Fusion des donn√©es trait√©es
python scripts/merge_processed_data.py --config config/data_config.yaml
```

### Entra√Ænement du mod√®le

```bash
# Entra√Ænement sur CPU (Lot 1 - DOGE & Co)
python scripts/train_rl_agent.py --config config/agent_config_cpu.yaml --profile lot1

# Entra√Ænement sur GPU (Lot 2 - BTC & Co)
python scripts/train_rl_agent.py --config config/agent_config_gpu.yaml --profile lot2
```

### √âvaluation du mod√®le

```bash
# √âvaluer les performances du mod√®le
python scripts/evaluate_agent.py --model_path models/best_model.zip --num_episodes 100
```

### D√©marrage du trading en direct (mode simulation)

```bash
python scripts/live_trading.py --mode paper --config config/live_config.yaml
```

## üß™ Tests

### Ex√©cution des tests unitaires

```bash
pytest tests/unit -v
```

### V√©rification de la couverture de code

```bash
pytest --cov=src tests/unit/
```

### V√©rification de la qualit√© du code

```bash
# V√©rification du formatage
black --check src/

# V√©rification du linting
flake8 src/

# V√©rification des types
mypy src/
```

## ü§ù Contribution

1. **Fork** le d√©p√¥t
2. Cr√©ez une **branche** pour votre fonctionnalit√© (`git checkout -b feature/AmazingFeature`)
3. **Commit** vos modifications (`git commit -m 'Add some AmazingFeature'`)
4. **Push** vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrez une **Pull Request**

### Bonnes pratiques de d√©veloppement

- √âcrivez des tests unitaires pour les nouvelles fonctionnalit√©s
- Assurez-vous que tous les tests passent avant de soumettre une PR
- Mettez √† jour la documentation si n√©cessaire
- Suivez les conventions de code du projet (PEP 8, docstrings, etc.)
- Utilisez des messages de commit clairs et descriptifs

## üìÑ Licence

Ce projet est sous licence MIT - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üôè Remerciements

- [Stable Baselines3](https://github.com/DLR-RM/stable-baselines3) - Pour l'impl√©mentation des algorithmes de RL
- [Gymnasium](https://github.com/Farama-Foundation/Gymnasium) - Pour les environnements de renforcement
- [CCXT](https://github.com/ccxt/ccxt) - Pour l'acc√®s aux API d'exchanges
- [TA-Lib](https://github.com/TA-Lib/ta-lib-python) - Pour les indicateurs techniques

## Utilisation

### D√©marrage Rapide

#### Lot 1 (DOGE & Co - 1h, 18 features)
```bash
conda activate trading_env
cd ADAN

# Pipeline complet Lot 1
python scripts/process_data.py --exec_profile cpu_lot1
python scripts/merge_processed_data.py --exec_profile cpu_lot1
python scripts/train_rl_agent.py --exec_profile cpu_lot1 --device cpu --initial_capital 15 --total_timesteps 200000
```

#### Lot 2 (BTC & Co - 1m, 47 features)
```bash
# Pipeline complet Lot 2
python scripts/process_data.py --exec_profile cpu_lot2
python scripts/merge_processed_data.py --exec_profile cpu_lot2
python scripts/train_rl_agent.py --exec_profile cpu_lot2 --device cpu --initial_capital 15 --total_timesteps 200000
```

### Ex√©cution GPU (Production)
```bash
# Lot 1 - Configuration optimis√©e : 8 workers parall√®les
python scripts/train_rl_agent.py --exec_profile gpu_lot1 --device cuda --initial_capital 15 --total_timesteps 2000000

# Lot 2 - Donn√©es riches 1m avec parall√©lisation
python scripts/train_rl_agent.py --exec_profile gpu_lot2 --device cuda --initial_capital 15 --total_timesteps 2000000
```

### Monitoring et Analyse

#### TensorBoard
```bash
tensorboard --logdir reports/tensorboard_logs --host 0.0.0.0 --port 6006
```
**M√©triques cl√©s :** rollout/ep_rew_mean, train/policy_loss, train/value_loss

#### GPU Monitoring
```bash
watch -n 1 nvidia-smi
```

### Configuration Avanc√©e

#### Profils d'Ex√©cution Multi-Lots

| Param√®tre | Lot 1 (cpu_lot1) | Lot 2 (cpu_lot2) |
|-----------|-------------------|-------------------|
| **Timesteps** | 200,000 | 200,000 |
| **Workers (n_envs)** | 1 | 1 |
| **Batch Size** | 64 | 64 |
| **Features** | ~18 (1h) | 47 (1m) |
| **Dur√©e** | 2-4h | 3-5h |

| Param√®tre | Lot 1 (gpu_lot1) | Lot 2 (gpu_lot2) |
|-----------|-------------------|-------------------|
| **Timesteps** | 2,000,000 | 2,000,000 |
| **Workers (n_envs)** | 8 | 8 |
| **Batch Size** | 512 | 512 |
| **Features** | ~18 (1h) | 47 (1m) |
| **Dur√©e** | 8-12h | 10-15h |

#### Personnalisation

- **Indicateurs Techniques** : Modifiez `config/data_config_*.yaml` section `indicators_by_timeframe` pour ajouter/supprimer des indicateurs.
- **Architecture Agent** : Ajustez `config/agent_config_*.yaml` pour modifier les dimensions du CNN, l'architecture MLP, et les hyperparam√®tres PPO.
- **Environnement Trading** : Configurez `config/environment_config.yaml` pour les paliers de capital, les p√©nalit√©s, les r√©compenses et les r√®gles de trading.

### Validation et Tests

#### Validation du Pipeline Multi-Lots
```bash
# Test court Lot 1 (DOGE & Co)
python scripts/train_rl_agent.py --exec_profile cpu_lot1 --device cpu --initial_capital 15 --total_timesteps 100

# Test court Lot 2 (BTC & Co)  
python scripts/train_rl_agent.py --exec_profile cpu_lot2 --device cpu --initial_capital 15 --total_timesteps 100

# Test environnement
python scripts/test_environment_with_merged_data.py --exec_profile cpu_lot1 --initial_capital 15
python scripts/test_environment_with_merged_data.py --exec_profile cpu_lot2 --initial_capital 15
```

#### V√©rifications Critiques Multi-Lots
```bash
# V√©rifier Lot 1 (doit √™tre ~85 colonnes : 5 assets √ó ~17 features)
python -c "import pandas as pd; df = pd.read_parquet('data/processed/merged/lot1/1h_train_merged.parquet'); print(f'Lot 1 Shape: {df.shape}')"

# V√©rifier Lot 2 (doit √™tre ~235 colonnes : 5 assets √ó 47 features)  
python -c "import pandas as pd; df = pd.read_parquet('data/processed/merged/lot2/1m_train_merged.parquet'); print(f'Lot 2 Shape: {df.shape}')"

# V√©rifier les features par lot
python -c "
import sys; sys.path.append('src')
from adan_trading_bot.common.utils import load_config
lot1_config = load_config('config/data_config_cpu_lot1.yaml')
lot2_config = load_config('config/data_config_cpu_lot2.yaml')
print(f'Lot 1 Features: {len(lot1_config["base_market_features"])} par asset')
print(f'Lot 2 Features: {len(lot2_config["base_market_features"])} par asset')
"
```

### Troubleshooting

#### Probl√®mes Courants

- **"FEATURE NON TROUV√âE"** : V√©rifier `base_market_features` dans `config/data_config_*_lot*.yaml`, s'assurer du bon profil (lot1 vs lot2), et r√©g√©n√©rer les donn√©es.
- **Erreur "Colonnes manquantes"** : Assurer que le lot choisi correspond aux donn√©es disponibles.
- **Erreur GPU/CUDA** : V√©rifier l'installation CUDA avec `python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"`.
- **Affichage Rich Corrompu** : Utiliser `TERM=dumb PYTHONIOENCODING=utf-8 PYTHONUNBUFFERED=1`.

## üìã Structure du Projet

```
ADAN/
‚îú‚îÄ‚îÄ config/                # Fichiers de configuration
‚îÇ   ‚îú‚îÄ‚îÄ environment_config.yaml  # Configuration de l'environnement et du DBE
‚îÇ   ‚îú‚îÄ‚îÄ agent_config_*.yaml      # Configurations des agents
‚îÇ   ‚îî‚îÄ‚îÄ data_config.yaml         # Configuration des donn√©es
‚îú‚îÄ‚îÄ data/                   # Donn√©es de march√©
‚îÇ   ‚îú‚îÄ‚îÄ raw/              # Donn√©es brutes
‚îÇ   ‚îî‚îÄ‚îÄ processed/        # Donn√©es trait√©es
‚îú‚îÄ‚îÄ models/               # Mod√®les entra√Æn√©s
‚îÇ   ‚îú‚îÄ‚îÄ saved_agents/     # Agents sauvegard√©s
‚îÇ   ‚îî‚îÄ‚îÄ dbe/              # √âtats du Dynamic Behavior Engine
‚îú‚îÄ‚îÄ notebooks/            # Notebooks d'analyse
‚îú‚îÄ‚îÄ reports/              # Rapports et r√©sultats
‚îÇ   ‚îú‚îÄ‚îÄ backtests/        # R√©sultats des backtests
‚îÇ   ‚îî‚îÄ‚îÄ metrics/          # M√©triques d'entra√Ænement
‚îú‚îÄ‚îÄ scripts/              # Scripts d'ex√©cution
‚îÇ   ‚îú‚îÄ‚îÄ train_rl_agent.py # Entra√Ænement initial
‚îÇ   ‚îú‚îÄ‚îÄ online_learning_agent.py  # Apprentissage continu
‚îÇ   ‚îî‚îÄ‚îÄ evaluate_performance.py   # √âvaluation et backtesting
‚îú‚îÄ‚îÄ src/                  # Code source
‚îÇ   ‚îî‚îÄ‚îÄ adan_trading_bot/
‚îÇ       ‚îú‚îÄ‚îÄ common/       # Utilitaires communs
‚îÇ       ‚îú‚îÄ‚îÄ data_processing/  # Traitement des donn√©es
‚îÇ       ‚îú‚îÄ‚îÄ environment/  # Environnement de trading
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dbe/      # Dynamic Behavior Engine
‚îÇ       ‚îî‚îÄ‚îÄ training/     # Scripts d'entra√Ænement
‚îî‚îÄ‚îÄ tests/                # Tests unitaires et d'int√©gration
```

## Contribution

1. Fork le projet
2. Cr√©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit les changements (`git commit -m 'Add AmazingFeature'`)
4. Push sur la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

## Contact

- **Auteur :** Cabrel
- **GitHub :** [Cabrel10](https://github.com/Cabrel10)
- **Projet :** [ADAN Repository](https://github.com/Cabrel10/ADAN)

---

**üéØ ADAN - Transformez vos strat√©gies de trading avec l'IA !**